FROM ubuntu:22.04

# Install dependencies
RUN apt-get update && apt-get install -y \
    curl \
    ca-certificates \
    git \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Install uv
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.cargo/bin:${PATH}"

# Install Claude Code
RUN curl -fsSL https://console.anthropic.com/install.sh | sh
ENV PATH="/root/.local/bin:${PATH}"

# Clone scientific-mcps repository
WORKDIR /root
RUN git clone https://github.com/iowarp/scientific-mcps.git

# Set up the MCP with uv
WORKDIR /root/scientific-mcps
RUN uv sync

# Configure Claude Code to use the ADIOS MCP
RUN mkdir -p /root/.config/claude
RUN echo '{\n\
  "mcpServers": {\n\
    "adios": {\n\
      "command": "uv",\n\
      "args": ["run", "adios-mcp"],\n\
      "cwd": "/root/scientific-mcps"\n\
    }\n\
  }\n\
}' > /root/.config/claude/config.json

WORKDIR /root

# Run Claude Code in interactive mode when container starts
ENTRYPOINT ["claude", "--dangerous-allow-server-access"]